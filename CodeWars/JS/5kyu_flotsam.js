// https://www.codewars.com/kata/635f67667dadea064acb2c4a/javascript

const names = { F: 'Frank', S: 'Sam', T: 'Tom' };
const broken = 'x',
    water = '~',
    empty = ' ',
    mark = '*';

const fill = (image, x, y, oceanLevel, dead) => {
    if (x < oceanLevel) return dead;

    const isLetter = /[A-Z]/.test(image[x]?.[y]);

    if (isLetter) dead.add(image[x][y]);

    if (isLetter || `${water}${empty}`.includes(image[x]?.[y])) {
        image[x][y] = mark;
        fill(image, x - 1, y, oceanLevel, dead);
        fill(image, x + 1, y, oceanLevel, dead);
        fill(image, x, y - 1, oceanLevel, dead);
        fill(image, x, y + 1, oceanLevel, dead);
    }

    return dead;
};

const solution = image => {
    const oceanLevel = image.findIndex(row => row.includes('~'));
    const letters = new Set();
    image = image.map(row => {
        return row.map(col => {
            if (/[A-Z]/.test(col)) letters.add(col);

            return col === broken ? empty : col;
        });
    });

    image.forEach((row, x) => {
        row.forEach((col, y) => {
            if (col !== water) return;
            const dead = fill(image, x, y, oceanLevel, new Set());
            dead.forEach(letter => letters.delete(letter));
        });
    });

    return [...letters]
        .map(letter => names[letter])
        .sort()
        .join(empty);
};
if (require.main.path.includes('mocha')) {
    const chai = require('chai');
    const assert = chai.assert;
    chai.config.truncateThreshold = 0;

    describe('Sea', function () {
        var field1 = [
            [
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                '|',
                '-',
                '|',
                ' ',
                '|',
                '-',
                '|',
                ' ',
                '|',
                '-',
                '|',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
            ],
            [
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                '|',
                ' ',
                '|',
                ' ',
                '|',
                ' ',
                '|',
                ' ',
                '|',
                ' ',
                '|',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
            ],
            [
                '~',
                '\\',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '|',
                '-',
                '|',
                '-',
                '|',
                '-',
                '|',
                '-',
                '|',
                '-',
                '|',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '/',
                '~',
            ],
            [
                '~',
                '~',
                '\\',
                ' ',
                ' ',
                ' ',
                'F',
                ' ',
                ' ',
                ' ',
                '│',
                ' ',
                ' ',
                ' ',
                'S',
                ' ',
                ' ',
                ' ',
                '│',
                ' ',
                ' ',
                ' ',
                'T',
                ' ',
                ' ',
                '/',
                '~',
                '~',
            ],
            [
                '~',
                '~',
                '~',
                '\\',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                'x',
                '-',
                '-',
                '-',
                '-',
                '-',
                '/',
                '~',
                '~',
                '~',
            ],
            [
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
            ],
        ];
        it('Okay', function () {
            assert.strictEqual(solution(field1), 'Frank Sam Tom');
        });
        var field2 = [
            [
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                '|',
                '-',
                '|',
                ' ',
                '|',
                '-',
                '|',
                ' ',
                '|',
                '-',
                '|',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
            ],
            [
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                '|',
                ' ',
                '|',
                ' ',
                '|',
                ' ',
                '|',
                ' ',
                '|',
                ' ',
                '|',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
            ],
            [
                '~',
                '\\',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '|',
                '-',
                '|',
                '-',
                '|',
                '-',
                '|',
                '-',
                '|',
                '-',
                '|',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '/',
                '~',
            ],
            [
                '~',
                '~',
                '\\',
                ' ',
                ' ',
                ' ',
                'F',
                ' ',
                ' ',
                ' ',
                '│',
                ' ',
                ' ',
                ' ',
                'S',
                ' ',
                ' ',
                ' ',
                '│',
                ' ',
                ' ',
                ' ',
                'T',
                ' ',
                ' ',
                'x',
                '~',
                '~',
            ],
            [
                '~',
                '~',
                '~',
                '\\',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '-',
                '/',
                '~',
                '~',
                '~',
            ],
            [
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
            ],
        ];
        it('Almost okay', function () {
            assert.strictEqual(solution(field2), 'Frank Sam');
        });
        var field3 = [
            [
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                '|',
                '=',
                '=',
                '|',
                ' ',
                ' ',
                '|',
                '=',
                '=',
                '|',
                ' ',
                ' ',
                '|',
                '=',
                '=',
                '|',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
            ],
            [
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                '_',
                '_',
                '|',
                '_',
                '_',
                '|',
                '_',
                '_',
                '|',
                '_',
                '_',
                '|',
                '_',
                '_',
                '|',
                '_',
                '_',
                '|',
                '_',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
            ],
            [
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                '_',
                '_',
                '|',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '|',
                '_',
                '_',
                '_',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
            ],
            [
                ' ',
                ' ',
                '_',
                '_',
                '|',
                '_',
                '_',
                '[',
                ']',
                '_',
                '_',
                '[',
                ']',
                '_',
                '_',
                '[',
                ']',
                '_',
                '_',
                '[',
                ']',
                '_',
                '_',
                '[',
                ']',
                '_',
                '_',
                '[',
                ']',
                '_',
                '_',
                '|',
                '_',
                'x',
                'x',
                'x',
            ],
            [
                '~',
                '|',
                ' ',
                ' ',
                ' ',
                'F',
                ' ',
                ' ',
                'x',
                ' ',
                ' ',
                'S',
                ' ',
                ' ',
                ' ',
                ' ',
                '|',
                ' ',
                ' ',
                'T',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                '/',
                '~',
            ],
            [
                '~',
                'x',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '|',
                '_',
                '_',
                '_',
                '_',
                '_',
                'x',
                '_',
                '|',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '/',
                '~',
                '~',
            ],
            [
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
            ],
        ];
        it('More', function () {
            assert.strictEqual(solution(field3), 'Tom');
        });
        var field4 = [
            [
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                '|',
                '=',
                '=',
                '|',
                ' ',
                ' ',
                '|',
                '=',
                '=',
                '|',
                ' ',
                ' ',
                '|',
                '=',
                '=',
                '|',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
            ],
            [
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                '_',
                '_',
                '|',
                '_',
                '_',
                '|',
                '_',
                '_',
                '|',
                '_',
                '_',
                '|',
                '_',
                '_',
                '|',
                '_',
                '_',
                '|',
                '_',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
            ],
            [
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                '_',
                '_',
                '|',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '|',
                '_',
                '_',
                '_',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
            ],
            [
                ' ',
                ' ',
                'x',
                '_',
                '|',
                '_',
                '_',
                '[',
                ']',
                '_',
                '_',
                '[',
                ']',
                '_',
                '_',
                '[',
                ']',
                '_',
                '_',
                '[',
                ']',
                '_',
                '_',
                '[',
                ']',
                '_',
                '_',
                '[',
                ']',
                '_',
                '_',
                '|',
                '_',
                '_',
                '_',
                ' ',
            ],
            [
                '~',
                '|',
                'x',
                ' ',
                ' ',
                'F',
                ' ',
                ' ',
                'x',
                ' ',
                ' ',
                'S',
                ' ',
                ' ',
                ' ',
                ' ',
                'x',
                ' ',
                ' ',
                'T',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                ' ',
                '/',
                '~',
            ],
            [
                '~',
                '|',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '|',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '|',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '_',
                '/',
                '~',
                '~',
            ],
            [
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
                '~',
            ],
        ];
        it('Inner problems', function () {
            assert.strictEqual(solution(field4), 'Frank Sam Tom');
        });
    });
}
